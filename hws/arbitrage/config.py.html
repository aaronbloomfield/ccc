<!-- Generator: GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite -->
<pre><tt><b><font color="#000080">import</font></b> hexbytes

<i><font color="#9A1900"># The configuration options to connect to the blockchain and the DEXes</font></i>
config <font color="#990000">=</font> <font color="#990000">{</font>
    <font color="#FF0000">'account_address'</font><font color="#990000">:</font> <font color="#FF0000">'0x123456789abcdef0123456789abcdef123456789'</font><font color="#990000">,</font>
    <font color="#FF0000">'account_private_key'</font><font color="#990000">:</font> hexbytes<font color="#990000">.</font><b><font color="#000000">HexBytes</font></b><font color="#990000">(</font><font color="#FF0000">'0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef'</font><font color="#990000">),</font>
    <font color="#FF0000">'connection_is_ipc'</font><font color="#990000">:</font> True<font color="#990000">,</font>
    <font color="#FF0000">'connection_uri'</font><font color="#990000">:</font> <font color="#FF0000">'/path/to/geth.ipc'</font><font color="#990000">,</font>
    <font color="#FF0000">'price_eth'</font><font color="#990000">:</font> <font color="#993399">100.00</font><font color="#990000">,</font>
    <font color="#FF0000">'price_tc'</font><font color="#990000">:</font> <font color="#993399">10.0</font><font color="#990000">,</font>
    <font color="#FF0000">'dex_addrs'</font><font color="#990000">:</font> <font color="#990000">[</font><font color="#FF0000">'0x123456789abcdef0123456789abcdef123456789'</font><font color="#990000">,</font> <font color="#FF0000">'0x123456789abcdef0123456789abcdef123456789'</font><font color="#990000">,</font> 
                  <font color="#FF0000">'0x123456789abcdef0123456789abcdef123456789'</font><font color="#990000">,</font> <font color="#FF0000">'0x123456789abcdef0123456789abcdef123456789'</font><font color="#990000">,</font>
                  <font color="#FF0000">'0x123456789abcdef0123456789abcdef123456789'</font><font color="#990000">],</font>
    <font color="#FF0000">'tokencc_addr'</font><font color="#990000">:</font> <font color="#FF0000">'0x123456789abcdef0123456789abcdef123456789'</font><font color="#990000">,</font>
<font color="#990000">}</font>

<i><font color="#9A1900"># This should do nothing for now -- we are going to use it when grading.  You</font></i>
<i><font color="#9A1900"># should call this first thing once the program starts, but after the import</font></i>
<i><font color="#9A1900"># lines.</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">hook</font></b><font color="#990000">():</font>
    <b><font color="#0000FF">pass</font></b>

<i><font color="#9A1900"># This will print the output into the format required by the homework.  It</font></i>
<i><font color="#9A1900"># should not be changed.</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">output</font></b><font color="#990000">(</font>ethAmt<font color="#990000">,</font> tcAmt<font color="#990000">,</font> fees<font color="#990000">,</font> holdings<font color="#990000">):</font>
    <b><font color="#0000FF">if</font></b> ethAmt <font color="#990000">==</font> <font color="#993399">0</font> <b><font color="#0000FF">and</font></b> tcAmt <font color="#990000">==</font> <font color="#993399">0</font><font color="#990000">:</font>
        <b><font color="#0000FF">print</font></b><font color="#990000">(</font><font color="#FF0000">"No profitable arbitrage trades available"</font><font color="#990000">)</font>
        <b><font color="#0000FF">return</font></b>
    <b><font color="#0000FF">assert</font></b> ethAmt <font color="#990000">*</font> tcAmt <font color="#990000">&lt;</font> <font color="#993399">0</font><font color="#990000">,</font> <font color="#FF0000">"Exactly one of ethAmt and tcAmt should be negative, the other positive"</font>
    <b><font color="#0000FF">if</font></b> ethAmt <font color="#990000">&lt;</font> <font color="#993399">0</font><font color="#990000">:</font>
        <b><font color="#0000FF">print</font></b><font color="#990000">(</font><font color="#FF0000">"Exchanged %f ETH for %f TC; fees: %f USD; prices: ETH %.2f USD, TC: %.4f USD; holdings: %.2f USD"</font> <font color="#990000">%</font>
              <b><font color="#000000">str</font></b><font color="#990000">(</font>ethAmt<font color="#990000">),</font> <b><font color="#000000">str</font></b><font color="#990000">(</font>tcAmt<font color="#990000">),</font> <b><font color="#000000">str</font></b><font color="#990000">(</font>fees<font color="#990000">),</font> config<font color="#990000">[</font><font color="#FF0000">'price_eth'</font><font color="#990000">],</font> config<font color="#990000">[</font><font color="#FF0000">'price_tc'</font><font color="#990000">],</font> <b><font color="#000000">str</font></b><font color="#990000">(</font>holdings<font color="#990000">))</font>
    <b><font color="#0000FF">else</font></b><font color="#990000">:</font>
        <b><font color="#0000FF">print</font></b><font color="#990000">(</font><font color="#FF0000">"Exchanged %f TC for %f ETH; fees: %f USD; prices: ETH %.2f USD, TC: %.4f USD; holdings: %.2f USD"</font> <font color="#990000">%</font>
              <b><font color="#000000">str</font></b><font color="#990000">(</font>tcAmt<font color="#990000">),</font> <b><font color="#000000">str</font></b><font color="#990000">(</font>ethAmt<font color="#990000">),</font> <b><font color="#000000">str</font></b><font color="#990000">(</font>fees<font color="#990000">),</font> config<font color="#990000">[</font><font color="#FF0000">'price_eth'</font><font color="#990000">],</font> config<font color="#990000">[</font><font color="#FF0000">'price_tc'</font><font color="#990000">],</font> <b><font color="#000000">str</font></b><font color="#990000">(</font>holdings<font color="#990000">))</font>

<i><font color="#9A1900"># This is the ABI for the DEX; it also includes that for a reset() function.</font></i>
dex_abi <font color="#990000">=</font> <font color="#FF0000">'[{"anonymous":false,"inputs":[],"name":"liquidityChangeEvent","type":"event"},{"inputs":[],"name":"addLiquidity","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_tokenAmount","type":"uint256"},{"internalType":"uint256","name":"_feeNumerator","type":"uint256"},{"internalType":"uint256","name":"_feeDenominator","type":"uint256"},{"internalType":"address","name":"_erc20token","type":"address"},{"internalType":"address","name":"_etherpricer","type":"address"}],"name":"createPool","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"erc20TokenAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"etherLiquidity","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"who","type":"address"}],"name":"etherLiquidityForAddress","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"etherPricerAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"exchangeEtherForToken","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amountToken","type":"uint256"}],"name":"exchangeTokenForEther","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"feeDenominator","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"feeNumerator","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"feesEther","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"feesToken","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getDEXinfo","outputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"string","name":"","type":"string"},{"internalType":"string","name":"","type":"string"},{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getEtherPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getPoolLiquidityInUSDCents","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTokenCCAbbreviation","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"getTokenPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"k","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amountEther","type":"uint256"}],"name":"removeLiquidity","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"reset","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"p","type":"address"}],"name":"setEtherPricer","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"tokenDecimals","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"tokenLiquidity","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"who","type":"address"}],"name":"tokenLiquidityForAddress","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"nonpayable","type":"function"}]'</font><font color="#990000">;</font>

<i><font color="#9A1900"># This is the ABI for the TokenCC contract.</font></i>
cc_abi <font color="#990000">=</font> <font color="#FF0000">'[{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"nonpayable","type":"function"}]'</font><font color="#990000">;</font>

<i><font color="#9A1900"># This function will attempt to ascertain why a transaction reverted, and</font></i>
<i><font color="#9A1900"># print that out.</font></i>
<b><font color="#0000FF">def</font></b> <b><font color="#000000">printRevertReason</font></b><font color="#990000">(</font>w3<font color="#990000">,</font>txhash<font color="#990000">):</font>
    tx <font color="#990000">=</font> w3<font color="#990000">.</font>eth<font color="#990000">.</font><b><font color="#000000">get_transaction</font></b><font color="#990000">(</font>txhash<font color="#990000">)</font>
    replay_tx <font color="#990000">=</font> <font color="#990000">{</font>
        <font color="#FF0000">'to'</font><font color="#990000">:</font> tx<font color="#990000">[</font><font color="#FF0000">'to'</font><font color="#990000">],</font>
        <font color="#FF0000">'from'</font><font color="#990000">:</font> tx<font color="#990000">[</font><font color="#FF0000">'from'</font><font color="#990000">],</font>
        <font color="#FF0000">'value'</font><font color="#990000">:</font> tx<font color="#990000">[</font><font color="#FF0000">'value'</font><font color="#990000">],</font>
        <font color="#FF0000">'data'</font><font color="#990000">:</font> tx<font color="#990000">[</font><font color="#FF0000">'input'</font><font color="#990000">],</font>
    <font color="#990000">}</font>
    <i><font color="#9A1900"># replay the transaction locally:</font></i>
    <b><font color="#0000FF">try</font></b><font color="#990000">:</font>
        w3<font color="#990000">.</font>eth<font color="#990000">.</font><b><font color="#000000">call</font></b><font color="#990000">(</font>replay_tx<font color="#990000">,</font> tx<font color="#990000">.</font>blockNumber <font color="#990000">-</font> <font color="#993399">1</font><font color="#990000">)</font>
    <b><font color="#0000FF">except</font></b> Exception as e<font color="#990000">:</font> 
        <b><font color="#0000FF">print</font></b><font color="#990000">(</font>e<font color="#990000">)</font>
</tt></pre>
