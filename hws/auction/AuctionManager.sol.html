<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite">
<title>AuctionManager.sol</title>
</head>
<body bgcolor="white">
<pre><tt><i><font color="#9A1900">// SPDX-License-Identifier: MIT</font></i>
<font color="#008080">pragma</font> solidity <font color="#990000">^</font><font color="#993399">0.8</font><font color="#990000">.</font><font color="#993399">7</font><font color="#990000">;</font>

import <font color="#FF0000">"./IERC721.sol"</font><font color="#990000">;</font>
import <font color="#FF0000">"./IERC721Receiver.sol"</font><font color="#990000">;</font>

interface AuctionManager <font color="#008080">is</font> IERC165<font color="#990000">,</font> IERC721Receiver <font color="#FF0000">{</font>

    <i><font color="#9A1900">// holds the information for each auction</font></i>
    <b><font color="#0000FF">struct</font></b> <font color="#008080">Auction</font> <font color="#FF0000">{</font>
        <font color="#008080">uint</font> id<font color="#990000">;</font>            <i><font color="#9A1900">// the auction id</font></i>
        <font color="#008080">uint</font> num_bids<font color="#990000">;</font>      <i><font color="#9A1900">// how many bids have been placed</font></i>
        <font color="#008080">string</font> data<font color="#990000">;</font>        <i><font color="#9A1900">// a text description of the auction or NFT data</font></i>
        <font color="#008080">uint</font> highestBid<font color="#990000">;</font>    <i><font color="#9A1900">// the current highest bid</font></i>
        <font color="#008080">uint</font> reserve<font color="#990000">;</font>       <i><font color="#9A1900">// the minimum bid allowed</font></i>
        <font color="#008080">address</font> winner<font color="#990000">;</font>     <i><font color="#9A1900">// the current highest bidder</font></i>
        <font color="#008080">address</font> initiator<font color="#990000">;</font>  <i><font color="#9A1900">// who started the auction</font></i>
        <font color="#008080">address</font> manager<font color="#990000">;</font>    <i><font color="#9A1900">// the ERC721 contract address that holds the NFT</font></i>
        <font color="#008080">uint</font> tokenId<font color="#990000">;</font>       <i><font color="#9A1900">// the token ID at that ERC721 manager</font></i>
        <font color="#008080">uint</font> endTime<font color="#990000">;</font>       <i><font color="#9A1900">// when the auction will end</font></i>
        <font color="#009900">bool</font> active<font color="#990000">;</font>        <i><font color="#9A1900">// if the auction is active</font></i>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">// There are four possible states for (endTime,active): </font></i>
    <i><font color="#9A1900">// - (0,false) is when the auction has ended</font></i>
    <i><font color="#9A1900">// - (0,true) should never occur</font></i>
    <i><font color="#9A1900">// - (&gt; 0, false) is when endTime is the duration, and it's waiting the NFT receipt</font></i>
    <i><font color="#9A1900">// - (&gt; 0, true) is when the auction is active</font></i>

    <i><font color="#9A1900">// how many auctions have been created; those auction IDs are 0 to n-1,</font></i>
    <i><font color="#9A1900">// where n is the value returned; this can just be via the getter method</font></i>
    <i><font color="#9A1900">// from a public variable</font></i>
    <font color="#008080">function</font> <b><font color="#000000">num_auctions</font></b><font color="#990000">()</font> external <font color="#008080">view</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint<font color="#990000">);</font>

    <i><font color="#9A1900">// gets the ID of any auction that is active with the provided data string</font></i>
    <font color="#008080">function</font> <b><font color="#000000">active_auction</font></b><font color="#990000">(</font>string <font color="#008080">memory</font> data<font color="#990000">)</font> external <font color="#008080">view</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint<font color="#990000">);</font>

    <i><font color="#9A1900">// gets the auction struct for the given acution; this can just be via the</font></i>
    <i><font color="#9A1900">// getter method from a public mapping</font></i>
    <font color="#008080">function</font> <b><font color="#000000">auctions</font></b><font color="#990000">(</font><font color="#008080">uint</font> _id<font color="#990000">)</font> external <font color="#008080">view</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font><font color="#008080">Auction</font> memory<font color="#990000">);</font>
    
    <i><font color="#9A1900">// this sets the data for the auction, but the auction time doesn't start</font></i>
    <i><font color="#9A1900">// until the ERC-721 contract is trasnferred over</font></i>
    <font color="#008080">function</font> <b><font color="#000000">createAuction</font></b><font color="#990000">(</font><font color="#008080">uint</font> m<font color="#990000">,</font> <font color="#008080">uint</font> h<font color="#990000">,</font> <font color="#008080">uint</font> d<font color="#990000">,</font> <font color="#008080">string</font> <font color="#008080">memory</font> _data<font color="#990000">,</font> <font color="#008080">uint</font> _reserve<font color="#990000">)</font> <font color="#008080">external</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint<font color="#990000">);</font>

    <i><font color="#9A1900">// this gets the ID of a pending auction; meaning one that has had</font></i>
    <i><font color="#9A1900">// createAuction() called, but the NFT has not yet been transferred over.</font></i>
    <i><font color="#9A1900">// It returns 0 (not revert!) if there is no pending auction for that address</font></i>
    <font color="#008080">function</font> <b><font color="#000000">getPendingAuctionID</font></b><font color="#990000">(</font>address<font color="#990000">)</font> external <font color="#008080">view</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint<font color="#990000">);</font>

    <i><font color="#9A1900">// cancel an auction that has been created but that the NFT has not yet be</font></i>
    <i><font color="#9A1900">// transferred over for</font></i>
    <font color="#008080">function</font> <b><font color="#000000">cancelAuction</font></b><font color="#990000">(</font><font color="#008080">uint</font> id<font color="#990000">)</font> external<font color="#990000">;</font>

    <i><font color="#9A1900">// this finishes the auction, but is only valid after the auction end</font></i>
    <i><font color="#9A1900">// time</font></i>
    <font color="#008080">function</font> <b><font color="#000000">closeAuction</font></b><font color="#990000">(</font><font color="#008080">uint</font> _id<font color="#990000">)</font> external<font color="#990000">;</font>

    <i><font color="#9A1900">// when one wants to submit a bid on a NFT</font></i>
    <font color="#008080">function</font> <b><font color="#000000">placeBid</font></b><font color="#990000">(</font><font color="#008080">uint</font> _id<font color="#990000">)</font> <font color="#008080">payable</font> external<font color="#990000">;</font>

    <i><font color="#9A1900">// the time left (in seconds) for the given auction; this can just be via</font></i>
    <i><font color="#9A1900">// the getter method from a public mapping</font></i>
    <font color="#008080">function</font> <b><font color="#000000">auctionTimeLeft</font></b><font color="#990000">(</font><font color="#008080">uint</font> _id<font color="#990000">)</font> external <font color="#008080">view</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint<font color="#990000">);</font>

    <i><font color="#9A1900">// when an auction starts (meaning when the NFT is transfered); the ID is</font></i>
    <i><font color="#9A1900">// the auction ID</font></i>
    <font color="#008080">event</font> <b><font color="#000000">auctionStartEvent</font></b><font color="#990000">(</font><font color="#008080">uint</font> <font color="#008080">indexed</font> _id<font color="#990000">);</font>

    <i><font color="#9A1900">// when an auction ends (in closeAuction() but not cancelAuction()); the</font></i>
    <i><font color="#9A1900">// ID is the auction ID</font></i>
    <font color="#008080">event</font> <b><font color="#000000">auctionEndEvent</font></b><font color="#990000">(</font><font color="#008080">uint</font> <font color="#008080">indexed</font> _id<font color="#990000">);</font>

    <i><font color="#9A1900">// when a new bid is placed that is higher than the existing highest bid;</font></i>
    <i><font color="#9A1900">// the ID is the auction ID</font></i>
    <font color="#008080">event</font> <b><font color="#000000">higherBidEvent</font></b> <font color="#990000">(</font><font color="#008080">uint</font> <font color="#008080">indexed</font> _id<font color="#990000">);</font>

<font color="#FF0000">}</font>
</tt></pre>
</body>
</html>
