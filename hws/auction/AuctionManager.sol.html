<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="GNU source-highlight 3.1.8
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite">
<title>AuctionManager.sol</title>
</head>
<body bgcolor="white">
<pre><tt><i><font color="#9A1900">// SPDX-License-Identifier: GPL</font></i>
<font color="#008080">pragma</font> solidity <font color="#990000">^</font><font color="#993399">0.8</font><font color="#990000">.</font><font color="#993399">7</font><font color="#990000">;</font>

import <font color="#FF0000">"./IERC721.sol"</font><font color="#990000">;</font>
import <font color="#FF0000">"./IERC721Receiver.sol"</font><font color="#990000">;</font>

<i><font color="#9A1900">// Some general notes:</font></i>
<i><font color="#9A1900">//</font></i>
<i><font color="#9A1900">// - All monetary values passed in as parameters to the functions below are in</font></i>
<i><font color="#9A1900">//   gwei; note that msg.value is in wei, so it will have to be divided by</font></i>
<i><font color="#9A1900">//   10**9 to get the amount in gwei</font></i>
<i><font color="#9A1900">// - Beyond what is listed below, there are two other methods to implement,</font></i>
<i><font color="#9A1900">//   based on the interfaces that this interface implements:</font></i>
<i><font color="#9A1900">//   supportsInterface()(from IERC165) and onERC721Received()</font></i>
<i><font color="#9A1900">//   (from IERC721Receiver).</font></i>
<i><font color="#9A1900">// - the onERC721Received() should do a whole bunch of checks, most of which</font></i>
<i><font color="#9A1900">//   are left for you to decide.  But it shoudl also check that the given URI</font></i>
<i><font color="#9A1900">//   is not already in an active (or configured and not yet started) auction.</font></i>
<i><font color="#9A1900">// - The parameters for onERC721Received() are:</font></i>
<i><font color="#9A1900">//   - operator: the address which called the `safeTrasnferFrom()` function;</font></i>
<i><font color="#9A1900">//     this can be ignored for this assignment</font></i>
<i><font color="#9A1900">//   - from: the address which previously owned the token</font></i>
<i><font color="#9A1900">//   - tokenId: the NFT identifier being transfered</font></i>
<i><font color="#9A1900">//   - data: additional data with no specified format; this can be ignored for</font></i>
<i><font color="#9A1900">//     this assignment</font></i>
<i><font color="#9A1900">// - There are four possible states for (endTime,active): </font></i>
<i><font color="#9A1900">//   - (0,false) is when the auction has ended</font></i>
<i><font color="#9A1900">//   - (0,true) should never occur</font></i>
<i><font color="#9A1900">//   - (&gt; 0, false) is when endTime is the duration, and it's waiting the NFT</font></i>
<i><font color="#9A1900">//     receipt</font></i>
<i><font color="#9A1900">//   - (&gt; 0, true) is when the auction is active</font></i>


interface AuctionManager <font color="#008080">is</font> IERC165<font color="#990000">,</font> IERC721Receiver <font color="#FF0000">{</font>

    <i><font color="#9A1900">// Holds the information for each auction</font></i>
    <b><font color="#0000FF">struct</font></b> <font color="#008080">Auction</font> <font color="#FF0000">{</font>
        <font color="#008080">uint</font> id<font color="#990000">;</font>            <i><font color="#9A1900">// the auction id</font></i>
        <font color="#008080">uint</font> num_bids<font color="#990000">;</font>      <i><font color="#9A1900">// how many bids have been placed</font></i>
        <font color="#008080">string</font> data<font color="#990000">;</font>        <i><font color="#9A1900">// a text description of the auction or NFT data</font></i>
        <font color="#008080">uint</font> highestBid<font color="#990000">;</font>    <i><font color="#9A1900">// the current highest bid</font></i>
        <font color="#008080">uint</font> reserve<font color="#990000">;</font>       <i><font color="#9A1900">// the minimum bid that can win</font></i>
        <font color="#008080">address</font> winner<font color="#990000">;</font>     <i><font color="#9A1900">// the current highest bidder</font></i>
        <font color="#008080">address</font> initiator<font color="#990000">;</font>  <i><font color="#9A1900">// who started the auction</font></i>
        <font color="#008080">address</font> manager<font color="#990000">;</font>    <i><font color="#9A1900">// the ERC721 contract address that holds the NFT</font></i>
        <font color="#008080">uint</font> tokenId<font color="#990000">;</font>       <i><font color="#9A1900">// the token ID at that ERC721 manager</font></i>
        <font color="#008080">uint</font> endTime<font color="#990000">;</font>       <i><font color="#9A1900">// when the auction will end</font></i>
        <font color="#009900">bool</font> active<font color="#990000">;</font>        <i><font color="#9A1900">// if the auction is active</font></i>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">// How many auctions have been created; those auction IDs are 1 to n(NOT 0</font></i>
    <i><font color="#9A1900">// to n-1), where n is the value returned; this can just be via the</font></i>
    <i><font color="#9A1900">// getter method from a public variable.</font></i>
    <font color="#008080">function</font> <b><font color="#000000">num_auctions</font></b><font color="#990000">()</font> external <font color="#008080">view</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint<font color="#990000">);</font>

    <i><font color="#9A1900">// How much fees, in wei, have been collected so far -- the auction</font></i>
    <i><font color="#9A1900">// collects 1% fees of *successful* auctions</font></i>
    <font color="#008080">function</font> <b><font color="#000000">fees</font></b><font color="#990000">()</font> external <font color="#008080">view</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint<font color="#990000">);</font>

    <i><font color="#9A1900">// The deployer of the contract, and ONLY that address, can collect the</font></i>
    <i><font color="#9A1900">// fees that this auction contract has accumulated; a call to this by any</font></i>
    <i><font color="#9A1900">// other address should revert.  This causes the fees to be paid to the</font></i>
    <i><font color="#9A1900">// deployer.</font></i>
    <font color="#008080">function</font> <b><font color="#000000">collectFees</font></b><font color="#990000">()</font> external<font color="#990000">;</font>

    <i><font color="#9A1900">// Gets the auction struct for the passed acution id.</font></i>
    <font color="#008080">function</font> <b><font color="#000000">auctions</font></b><font color="#990000">(</font><font color="#008080">uint</font> _id<font color="#990000">)</font> external <font color="#008080">view</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font><font color="#008080">Auction</font> memory<font color="#990000">);</font>
    
    <i><font color="#9A1900">// This sets the data for the auction, but the auction time doesn't start</font></i>
    <i><font color="#9A1900">// until the ERC-721 contract is trasnferred over.  The first three</font></i>
    <i><font color="#9A1900">// parameters are the number of minutes, hours, and days for the auction</font></i>
    <i><font color="#9A1900">// to last -- they can't all be zero.  The data parameter is a textual</font></i>
    <i><font color="#9A1900">// description of the auction, NOT the file name.  The reserve is the</font></i>
    <i><font color="#9A1900">// minimum price that will win the auction; this amount is in gwei</font></i>
    <i><font color="#9A1900">// (which is 10^-9 eth). This returns the auction ID of the newly</font></i>
    <i><font color="#9A1900">// configured auction.</font></i>
    <font color="#008080">function</font> <b><font color="#000000">createAuction</font></b><font color="#990000">(</font><font color="#008080">uint</font> m<font color="#990000">,</font> <font color="#008080">uint</font> h<font color="#990000">,</font> <font color="#008080">uint</font> d<font color="#990000">,</font> <font color="#008080">string</font> <font color="#008080">memory</font> _data<font color="#990000">,</font> <font color="#008080">uint</font> _reserve<font color="#990000">)</font> 
                    <font color="#008080">external</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint<font color="#990000">);</font>

    <i><font color="#9A1900">// This cancels an auction, the id of which is passed in as a parameter,</font></i>
    <i><font color="#9A1900">// that has been created but that the NFT has not yet be transferred over</font></i>
    <i><font color="#9A1900">// for.</font></i>
    <font color="#008080">function</font> <b><font color="#000000">cancelAuction</font></b><font color="#990000">(</font><font color="#008080">uint</font> id<font color="#990000">)</font> external<font color="#990000">;</font>

    <i><font color="#9A1900">// This closes out the auction, the ID of which is passed in as a</font></i>
    <i><font color="#9A1900">// parameter, but is only valid after the auction end time.  It will</font></i>
    <i><font color="#9A1900">// handle the transfer of the ETH (if any bids were placed) and the NFT.</font></i>
    <i><font color="#9A1900">// Note that anybody can call this function, although it will only close</font></i>
    <i><font color="#9A1900">// auctions whose time has expired.</font></i>
    <font color="#008080">function</font> <b><font color="#000000">closeAuction</font></b><font color="#990000">(</font><font color="#008080">uint</font> _id<font color="#990000">)</font> external<font color="#990000">;</font>

    <i><font color="#9A1900">// When one wants to submit a bid on a NFT; the ID of the auction is</font></i>
    <i><font color="#9A1900">// passed in as a parameter, and some amount of ETH is transferred with</font></i>
    <i><font color="#9A1900">// this function call.</font></i>
    <font color="#008080">function</font> <b><font color="#000000">placeBid</font></b><font color="#990000">(</font><font color="#008080">uint</font> _id<font color="#990000">)</font> <font color="#008080">payable</font> external<font color="#990000">;</font>

    <i><font color="#9A1900">// The time left (in seconds) for the given auction, the ID of which is</font></i>
    <i><font color="#9A1900">// passed in as a parameter.</font></i>
    <font color="#008080">function</font> <b><font color="#000000">auctionTimeLeft</font></b><font color="#990000">(</font><font color="#008080">uint</font> _id<font color="#990000">)</font> external <font color="#008080">view</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint<font color="#990000">);</font>

    <i><font color="#9A1900">// This is emitted when an auction starts (meaning when the NFT is</font></i>
    <i><font color="#9A1900">// transfered); the ID is the auction ID.</font></i>
    <font color="#008080">event</font> <b><font color="#000000">auctionStartEvent</font></b><font color="#990000">(</font><font color="#008080">uint</font> <font color="#008080">indexed</font> _id<font color="#990000">);</font>

    <i><font color="#9A1900">// This is emitted when an auction ends (in closeAuction() but not</font></i>
    <i><font color="#9A1900">// cancelAuction()); the ID is the auction ID.</font></i>
    <font color="#008080">event</font> <b><font color="#000000">auctionEndEvent</font></b><font color="#990000">(</font><font color="#008080">uint</font> <font color="#008080">indexed</font> _id<font color="#990000">);</font>

    <i><font color="#9A1900">// This is emitted when a new bid is placed that is higher than the</font></i>
    <i><font color="#9A1900">// existing highest bid; the ID is the auction ID.</font></i>
    <font color="#008080">event</font> <b><font color="#000000">higherBidEvent</font></b> <font color="#990000">(</font><font color="#008080">uint</font> <font color="#008080">indexed</font> _id<font color="#990000">);</font>

<font color="#FF0000">}</font>
</tt></pre>
</body>
</html>
