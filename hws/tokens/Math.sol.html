<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">
<meta name="GENERATOR" content="GNU source-highlight 3.1.9
by Lorenzo Bettini
http://www.lorenzobettini.it
http://www.gnu.org/software/src-highlite">
<title>Math.sol</title>
</head>
<body bgcolor="white">
<pre><tt><i><font color="#9A1900">// SPDX-License-Identifier: MIT</font></i>
<i><font color="#9A1900">// OpenZeppelin Contracts (last updated v4.7.0) (utils/math/Math.sol)</font></i>

<font color="#008080">pragma</font> solidity <font color="#990000">^</font><font color="#993399">0.8</font><font color="#990000">.</font><font color="#993399">0</font><font color="#990000">;</font>

<i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900"> * </font></i><font color="#009900">@dev</font><i><font color="#9A1900"> Standard math utilities missing in the Solidity language.</font></i>
<i><font color="#9A1900"> */</font></i>
<font color="#008080">library</font> Math <font color="#FF0000">{</font>
    <b><font color="#0000FF">enum</font></b> <font color="#008080">Rounding</font> <font color="#FF0000">{</font>
        Down<font color="#990000">,</font> <i><font color="#9A1900">// Toward negative infinity</font></i>
        Up<font color="#990000">,</font> <i><font color="#9A1900">// Toward infinity</font></i>
        Zero <i><font color="#9A1900">// Toward zero</font></i>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@dev</font><i><font color="#9A1900"> Returns the largest of two numbers.</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">max</font></b><font color="#990000">(</font><font color="#008080">uint256</font> a<font color="#990000">,</font> <font color="#008080">uint256</font> b<font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint256<font color="#990000">)</font> <font color="#FF0000">{</font>
        <b><font color="#0000FF">return</font></b> a <font color="#990000">&gt;</font> b <font color="#990000">?</font> a <font color="#990000">:</font> b<font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@dev</font><i><font color="#9A1900"> Returns the smallest of two numbers.</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">min</font></b><font color="#990000">(</font><font color="#008080">uint256</font> a<font color="#990000">,</font> <font color="#008080">uint256</font> b<font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint256<font color="#990000">)</font> <font color="#FF0000">{</font>
        <b><font color="#0000FF">return</font></b> a <font color="#990000">&lt;</font> b <font color="#990000">?</font> a <font color="#990000">:</font> b<font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@dev</font><i><font color="#9A1900"> Returns the average of two numbers. The result is rounded towards</font></i>
<i><font color="#9A1900">     * zero.</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">average</font></b><font color="#990000">(</font><font color="#008080">uint256</font> a<font color="#990000">,</font> <font color="#008080">uint256</font> b<font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint256<font color="#990000">)</font> <font color="#FF0000">{</font>
        <i><font color="#9A1900">// (a + b) / 2 can overflow.</font></i>
        <b><font color="#0000FF">return</font></b> <font color="#990000">(</font>a <font color="#990000">&amp;</font> b<font color="#990000">)</font> <font color="#990000">+</font> <font color="#990000">(</font>a <font color="#990000">^</font> b<font color="#990000">)</font> <font color="#990000">/</font> <font color="#993399">2</font><font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@dev</font><i><font color="#9A1900"> Returns the ceiling of the division of two numbers.</font></i>
<i><font color="#9A1900">     *</font></i>
<i><font color="#9A1900">     * This differs from standard division with `/` in that it rounds up instead</font></i>
<i><font color="#9A1900">     * of rounding down.</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">ceilDiv</font></b><font color="#990000">(</font><font color="#008080">uint256</font> a<font color="#990000">,</font> <font color="#008080">uint256</font> b<font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint256<font color="#990000">)</font> <font color="#FF0000">{</font>
        <i><font color="#9A1900">// (a + b - 1) / b can overflow on addition, so we distribute.</font></i>
        <b><font color="#0000FF">return</font></b> a <font color="#990000">==</font> <font color="#993399">0</font> <font color="#990000">?</font> <font color="#993399">0</font> <font color="#990000">:</font> <font color="#990000">(</font>a <font color="#990000">-</font> <font color="#993399">1</font><font color="#990000">)</font> <font color="#990000">/</font> b <font color="#990000">+</font> <font color="#993399">1</font><font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@notice</font><i><font color="#9A1900"> Calculates floor(x * y / denominator) with full precision. Throws if result overflows a uint256 or denominator == 0</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@dev</font><i><font color="#9A1900"> Original credit to Remco Bloemen under MIT license (</font></i><u><font color="#0000FF">https://xn--2-umb.com/21/muldiv</font></u><i><font color="#9A1900">)</font></i>
<i><font color="#9A1900">     * with further edits by Uniswap Labs also under MIT license.</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">mulDiv</font></b><font color="#990000">(</font>
        <font color="#008080">uint256</font> x<font color="#990000">,</font>
        <font color="#008080">uint256</font> y<font color="#990000">,</font>
        uint256 denominator
    <font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font><font color="#008080">uint256</font> result<font color="#990000">)</font> <font color="#FF0000">{</font>
        unchecked <font color="#FF0000">{</font>
            <i><font color="#9A1900">// 512-bit multiply [prod1 prod0] = x * y. Compute the product mod 2^256 and mod 2^256 - 1, then use</font></i>
            <i><font color="#9A1900">// use the Chinese Remainder Theorem to reconstruct the 512 bit result. The result is stored in two 256</font></i>
            <i><font color="#9A1900">// variables such that product = prod1 * 2^256 + prod0.</font></i>
            <font color="#008080">uint256</font> prod0<font color="#990000">;</font> <i><font color="#9A1900">// Least significant 256 bits of the product</font></i>
            <font color="#008080">uint256</font> prod1<font color="#990000">;</font> <i><font color="#9A1900">// Most significant 256 bits of the product</font></i>
            assembly <font color="#FF0000">{</font>
                <font color="#008080">let</font> mm <font color="#990000">:=</font> <b><font color="#000000">mulmod</font></b><font color="#990000">(</font>x<font color="#990000">,</font> y<font color="#990000">,</font> <b><font color="#000000">not</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">))</font>
                prod0 <font color="#990000">:=</font> <b><font color="#000000">mul</font></b><font color="#990000">(</font>x<font color="#990000">,</font> y<font color="#990000">)</font>
                prod1 <font color="#990000">:=</font> <b><font color="#000000">sub</font></b><font color="#990000">(</font><b><font color="#000000">sub</font></b><font color="#990000">(</font>mm<font color="#990000">,</font> prod0<font color="#990000">),</font> <b><font color="#000000">lt</font></b><font color="#990000">(</font>mm<font color="#990000">,</font> prod0<font color="#990000">))</font>
            <font color="#FF0000">}</font>

            <i><font color="#9A1900">// Handle non-overflow cases, 256 by 256 division.</font></i>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>prod1 <font color="#990000">==</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                <b><font color="#0000FF">return</font></b> prod0 <font color="#990000">/</font> denominator<font color="#990000">;</font>
            <font color="#FF0000">}</font>

            <i><font color="#9A1900">// Make sure the result is less than 2^256. Also prevents denominator == 0.</font></i>
            <b><font color="#000000">require</font></b><font color="#990000">(</font>denominator <font color="#990000">&gt;</font> prod1<font color="#990000">);</font>

            <i><font color="#9A1900">///////////////////////////////////////////////</font></i>
            <i><font color="#9A1900">// 512 by 256 division.</font></i>
            <i><font color="#9A1900">///////////////////////////////////////////////</font></i>

            <i><font color="#9A1900">// Make division exact by subtracting the remainder from [prod1 prod0].</font></i>
            <font color="#008080">uint256</font> remainder<font color="#990000">;</font>
            assembly <font color="#FF0000">{</font>
                <i><font color="#9A1900">// Compute remainder using mulmod.</font></i>
                remainder <font color="#990000">:=</font> <b><font color="#000000">mulmod</font></b><font color="#990000">(</font>x<font color="#990000">,</font> y<font color="#990000">,</font> denominator<font color="#990000">)</font>

                <i><font color="#9A1900">// Subtract 256 bit number from 512 bit number.</font></i>
                prod1 <font color="#990000">:=</font> <b><font color="#000000">sub</font></b><font color="#990000">(</font>prod1<font color="#990000">,</font> <b><font color="#000000">gt</font></b><font color="#990000">(</font>remainder<font color="#990000">,</font> prod0<font color="#990000">))</font>
                prod0 <font color="#990000">:=</font> <b><font color="#000000">sub</font></b><font color="#990000">(</font>prod0<font color="#990000">,</font> remainder<font color="#990000">)</font>
            <font color="#FF0000">}</font>

            <i><font color="#9A1900">// Factor powers of two out of denominator and compute largest power of two divisor of denominator. Always &gt;= 1.</font></i>
            <i><font color="#9A1900">// See https://cs.stackexchange.com/q/138556/92363.</font></i>

            <i><font color="#9A1900">// Does not overflow because the denominator cannot be zero at this stage in the function.</font></i>
            <font color="#008080">uint256</font> twos <font color="#990000">=</font> denominator <font color="#990000">&amp;</font> <font color="#990000">(~</font>denominator <font color="#990000">+</font> <font color="#993399">1</font><font color="#990000">);</font>
            assembly <font color="#FF0000">{</font>
                <i><font color="#9A1900">// Divide denominator by twos.</font></i>
                denominator <font color="#990000">:=</font> <b><font color="#000000">div</font></b><font color="#990000">(</font>denominator<font color="#990000">,</font> twos<font color="#990000">)</font>

                <i><font color="#9A1900">// Divide [prod1 prod0] by twos.</font></i>
                prod0 <font color="#990000">:=</font> <b><font color="#000000">div</font></b><font color="#990000">(</font>prod0<font color="#990000">,</font> twos<font color="#990000">)</font>

                <i><font color="#9A1900">// Flip twos such that it is 2^256 / twos. If twos is zero, then it becomes one.</font></i>
                twos <font color="#990000">:=</font> <b><font color="#000000">add</font></b><font color="#990000">(</font><b><font color="#000000">div</font></b><font color="#990000">(</font><b><font color="#000000">sub</font></b><font color="#990000">(</font><font color="#993399">0</font><font color="#990000">,</font> twos<font color="#990000">),</font> twos<font color="#990000">),</font> <font color="#993399">1</font><font color="#990000">)</font>
            <font color="#FF0000">}</font>

            <i><font color="#9A1900">// Shift in bits from prod1 into prod0.</font></i>
            prod0 <font color="#990000">|=</font> prod1 <font color="#990000">*</font> twos<font color="#990000">;</font>

            <i><font color="#9A1900">// Invert denominator mod 2^256. Now that denominator is an odd number, it has an inverse modulo 2^256 such</font></i>
            <i><font color="#9A1900">// that denominator * inv = 1 mod 2^256. Compute the inverse by starting with a seed that is correct for</font></i>
            <i><font color="#9A1900">// four bits. That is, denominator * inv = 1 mod 2^4.</font></i>
            <font color="#008080">uint256</font> inverse <font color="#990000">=</font> <font color="#990000">(</font><font color="#993399">3</font> <font color="#990000">*</font> denominator<font color="#990000">)</font> <font color="#990000">^</font> <font color="#993399">2</font><font color="#990000">;</font>

            <i><font color="#9A1900">// Use the Newton-Raphson iteration to improve the precision. Thanks to Hensel's lifting lemma, this also works</font></i>
            <i><font color="#9A1900">// in modular arithmetic, doubling the correct bits in each step.</font></i>
            inverse <font color="#990000">*=</font> <font color="#993399">2</font> <font color="#990000">-</font> denominator <font color="#990000">*</font> inverse<font color="#990000">;</font> <i><font color="#9A1900">// inverse mod 2^8</font></i>
            inverse <font color="#990000">*=</font> <font color="#993399">2</font> <font color="#990000">-</font> denominator <font color="#990000">*</font> inverse<font color="#990000">;</font> <i><font color="#9A1900">// inverse mod 2^16</font></i>
            inverse <font color="#990000">*=</font> <font color="#993399">2</font> <font color="#990000">-</font> denominator <font color="#990000">*</font> inverse<font color="#990000">;</font> <i><font color="#9A1900">// inverse mod 2^32</font></i>
            inverse <font color="#990000">*=</font> <font color="#993399">2</font> <font color="#990000">-</font> denominator <font color="#990000">*</font> inverse<font color="#990000">;</font> <i><font color="#9A1900">// inverse mod 2^64</font></i>
            inverse <font color="#990000">*=</font> <font color="#993399">2</font> <font color="#990000">-</font> denominator <font color="#990000">*</font> inverse<font color="#990000">;</font> <i><font color="#9A1900">// inverse mod 2^128</font></i>
            inverse <font color="#990000">*=</font> <font color="#993399">2</font> <font color="#990000">-</font> denominator <font color="#990000">*</font> inverse<font color="#990000">;</font> <i><font color="#9A1900">// inverse mod 2^256</font></i>

            <i><font color="#9A1900">// Because the division is now exact we can divide by multiplying with the modular inverse of denominator.</font></i>
            <i><font color="#9A1900">// This will give us the correct result modulo 2^256. Since the preconditions guarantee that the outcome is</font></i>
            <i><font color="#9A1900">// less than 2^256, this is the final result. We don't need to compute the high bits of the result and prod1</font></i>
            <i><font color="#9A1900">// is no longer required.</font></i>
            result <font color="#990000">=</font> prod0 <font color="#990000">*</font> inverse<font color="#990000">;</font>
            <b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
        <font color="#FF0000">}</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@notice</font><i><font color="#9A1900"> Calculates x * y / denominator with full precision, following the selected rounding direction.</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">mulDiv</font></b><font color="#990000">(</font>
        <font color="#008080">uint256</font> x<font color="#990000">,</font>
        <font color="#008080">uint256</font> y<font color="#990000">,</font>
        <font color="#008080">uint256</font> denominator<font color="#990000">,</font>
        Rounding rounding
    <font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint256<font color="#990000">)</font> <font color="#FF0000">{</font>
        <font color="#008080">uint256</font> result <font color="#990000">=</font> <b><font color="#000000">mulDiv</font></b><font color="#990000">(</font>x<font color="#990000">,</font> y<font color="#990000">,</font> denominator<font color="#990000">);</font>
        <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>rounding <font color="#990000">==</font> Rounding<font color="#990000">.</font>Up <font color="#990000">&amp;&amp;</font> <b><font color="#000000">mulmod</font></b><font color="#990000">(</font>x<font color="#990000">,</font> y<font color="#990000">,</font> denominator<font color="#990000">)</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
            result <font color="#990000">+=</font> <font color="#993399">1</font><font color="#990000">;</font>
        <font color="#FF0000">}</font>
        <b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@dev</font><i><font color="#9A1900"> Returns the square root of a number. If the number is not a perfect square, the value is rounded down.</font></i>
<i><font color="#9A1900">     *</font></i>
<i><font color="#9A1900">     * Inspired by Henry S. Warren, Jr.'s "Hacker's Delight" (Chapter 11).</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">sqrt</font></b><font color="#990000">(</font><font color="#008080">uint256</font> a<font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint256<font color="#990000">)</font> <font color="#FF0000">{</font>
        <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>a <font color="#990000">==</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
            <b><font color="#0000FF">return</font></b> <font color="#993399">0</font><font color="#990000">;</font>
        <font color="#FF0000">}</font>

        <i><font color="#9A1900">// For our first guess, we get the biggest power of 2 which is smaller than the square root of the target.</font></i>
        <i><font color="#9A1900">//</font></i>
        <i><font color="#9A1900">// We know that the "msb" (most significant bit) of our target number `a` is a power of 2 such that we have</font></i>
        <i><font color="#9A1900">// `msb(a) &lt;= a &lt; 2*msb(a)`. This value can be written `msb(a)=2**k` with `k=log2(a)`.</font></i>
        <i><font color="#9A1900">//</font></i>
        <i><font color="#9A1900">// This can be rewritten `2**log2(a) &lt;= a &lt; 2**(log2(a) + 1)`</font></i>
        <i><font color="#9A1900">// → `sqrt(2**k) &lt;= sqrt(a) &lt; sqrt(2**(k+1))`</font></i>
        <i><font color="#9A1900">// → `2**(k/2) &lt;= sqrt(a) &lt; 2**((k+1)/2) &lt;= 2**(k/2 + 1)`</font></i>
        <i><font color="#9A1900">//</font></i>
        <i><font color="#9A1900">// Consequently, `2**(log2(a) / 2)` is a good first approximation of `sqrt(a)` with at least 1 correct bit.</font></i>
        <font color="#008080">uint256</font> result <font color="#990000">=</font> <font color="#993399">1</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">(</font><b><font color="#000000">log2</font></b><font color="#990000">(</font>a<font color="#990000">)</font> <font color="#990000">&gt;&gt;</font> <font color="#993399">1</font><font color="#990000">);</font>

        <i><font color="#9A1900">// At this point `result` is an estimation with one bit of precision. We know the true value is a uint128,</font></i>
        <i><font color="#9A1900">// since it is the square root of a uint256. Newton's method converges quadratically (precision doubles at</font></i>
        <i><font color="#9A1900">// every iteration). We thus need at most 7 iteration to turn our partial result with one bit of precision</font></i>
        <i><font color="#9A1900">// into the expected uint128 result.</font></i>
        unchecked <font color="#FF0000">{</font>
            result <font color="#990000">=</font> <font color="#990000">(</font>result <font color="#990000">+</font> a <font color="#990000">/</font> result<font color="#990000">)</font> <font color="#990000">&gt;&gt;</font> <font color="#993399">1</font><font color="#990000">;</font>
            result <font color="#990000">=</font> <font color="#990000">(</font>result <font color="#990000">+</font> a <font color="#990000">/</font> result<font color="#990000">)</font> <font color="#990000">&gt;&gt;</font> <font color="#993399">1</font><font color="#990000">;</font>
            result <font color="#990000">=</font> <font color="#990000">(</font>result <font color="#990000">+</font> a <font color="#990000">/</font> result<font color="#990000">)</font> <font color="#990000">&gt;&gt;</font> <font color="#993399">1</font><font color="#990000">;</font>
            result <font color="#990000">=</font> <font color="#990000">(</font>result <font color="#990000">+</font> a <font color="#990000">/</font> result<font color="#990000">)</font> <font color="#990000">&gt;&gt;</font> <font color="#993399">1</font><font color="#990000">;</font>
            result <font color="#990000">=</font> <font color="#990000">(</font>result <font color="#990000">+</font> a <font color="#990000">/</font> result<font color="#990000">)</font> <font color="#990000">&gt;&gt;</font> <font color="#993399">1</font><font color="#990000">;</font>
            result <font color="#990000">=</font> <font color="#990000">(</font>result <font color="#990000">+</font> a <font color="#990000">/</font> result<font color="#990000">)</font> <font color="#990000">&gt;&gt;</font> <font color="#993399">1</font><font color="#990000">;</font>
            result <font color="#990000">=</font> <font color="#990000">(</font>result <font color="#990000">+</font> a <font color="#990000">/</font> result<font color="#990000">)</font> <font color="#990000">&gt;&gt;</font> <font color="#993399">1</font><font color="#990000">;</font>
            <b><font color="#0000FF">return</font></b> <b><font color="#000000">min</font></b><font color="#990000">(</font>result<font color="#990000">,</font> a <font color="#990000">/</font> result<font color="#990000">);</font>
        <font color="#FF0000">}</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@notice</font><i><font color="#9A1900"> Calculates sqrt(a), following the selected rounding direction.</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">sqrt</font></b><font color="#990000">(</font><font color="#008080">uint256</font> a<font color="#990000">,</font> <font color="#008080">Rounding</font> rounding<font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint256<font color="#990000">)</font> <font color="#FF0000">{</font>
        unchecked <font color="#FF0000">{</font>
            <font color="#008080">uint256</font> result <font color="#990000">=</font> <b><font color="#000000">sqrt</font></b><font color="#990000">(</font>a<font color="#990000">);</font>
            <b><font color="#0000FF">return</font></b> result <font color="#990000">+</font> <font color="#990000">(</font>rounding <font color="#990000">==</font> Rounding<font color="#990000">.</font>Up <font color="#990000">&amp;&amp;</font> result <font color="#990000">*</font> result <font color="#990000">&lt;</font> a <font color="#990000">?</font> <font color="#993399">1</font> <font color="#990000">:</font> <font color="#993399">0</font><font color="#990000">);</font>
        <font color="#FF0000">}</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@dev</font><i><font color="#9A1900"> Return the log in base 2, rounded down, of a positive value.</font></i>
<i><font color="#9A1900">     * Returns 0 if given 0.</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">log2</font></b><font color="#990000">(</font><font color="#008080">uint256</font> value<font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint256<font color="#990000">)</font> <font color="#FF0000">{</font>
        <font color="#008080">uint256</font> result <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
        unchecked <font color="#FF0000">{</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;&gt;</font> <font color="#993399">128</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">&gt;&gt;=</font> <font color="#993399">128</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">128</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;&gt;</font> <font color="#993399">64</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">&gt;&gt;=</font> <font color="#993399">64</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">64</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;&gt;</font> <font color="#993399">32</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">&gt;&gt;=</font> <font color="#993399">32</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">32</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;&gt;</font> <font color="#993399">16</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">&gt;&gt;=</font> <font color="#993399">16</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">16</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;&gt;</font> <font color="#993399">8</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">&gt;&gt;=</font> <font color="#993399">8</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">8</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;&gt;</font> <font color="#993399">4</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">&gt;&gt;=</font> <font color="#993399">4</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">4</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;&gt;</font> <font color="#993399">2</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">&gt;&gt;=</font> <font color="#993399">2</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">2</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;&gt;</font> <font color="#993399">1</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                result <font color="#990000">+=</font> <font color="#993399">1</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
        <font color="#FF0000">}</font>
        <b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@dev</font><i><font color="#9A1900"> Return the log in base 2, following the selected rounding direction, of a positive value.</font></i>
<i><font color="#9A1900">     * Returns 0 if given 0.</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">log2</font></b><font color="#990000">(</font><font color="#008080">uint256</font> value<font color="#990000">,</font> <font color="#008080">Rounding</font> rounding<font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint256<font color="#990000">)</font> <font color="#FF0000">{</font>
        unchecked <font color="#FF0000">{</font>
            <font color="#008080">uint256</font> result <font color="#990000">=</font> <b><font color="#000000">log2</font></b><font color="#990000">(</font>value<font color="#990000">);</font>
            <b><font color="#0000FF">return</font></b> result <font color="#990000">+</font> <font color="#990000">(</font>rounding <font color="#990000">==</font> Rounding<font color="#990000">.</font>Up <font color="#990000">&amp;&amp;</font> <font color="#993399">1</font> <font color="#990000">&lt;&lt;</font> result <font color="#990000">&lt;</font> value <font color="#990000">?</font> <font color="#993399">1</font> <font color="#990000">:</font> <font color="#993399">0</font><font color="#990000">);</font>
        <font color="#FF0000">}</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@dev</font><i><font color="#9A1900"> Return the log in base 10, rounded down, of a positive value.</font></i>
<i><font color="#9A1900">     * Returns 0 if given 0.</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">log10</font></b><font color="#990000">(</font><font color="#008080">uint256</font> value<font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint256<font color="#990000">)</font> <font color="#FF0000">{</font>
        <font color="#008080">uint256</font> result <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
        unchecked <font color="#FF0000">{</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;=</font> <font color="#993399">10</font><font color="#990000">**</font><font color="#993399">64</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">/=</font> <font color="#993399">10</font><font color="#990000">**</font><font color="#993399">64</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">64</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;=</font> <font color="#993399">10</font><font color="#990000">**</font><font color="#993399">32</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">/=</font> <font color="#993399">10</font><font color="#990000">**</font><font color="#993399">32</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">32</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;=</font> <font color="#993399">10</font><font color="#990000">**</font><font color="#993399">16</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">/=</font> <font color="#993399">10</font><font color="#990000">**</font><font color="#993399">16</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">16</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;=</font> <font color="#993399">10</font><font color="#990000">**</font><font color="#993399">8</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">/=</font> <font color="#993399">10</font><font color="#990000">**</font><font color="#993399">8</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">8</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;=</font> <font color="#993399">10</font><font color="#990000">**</font><font color="#993399">4</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">/=</font> <font color="#993399">10</font><font color="#990000">**</font><font color="#993399">4</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">4</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;=</font> <font color="#993399">10</font><font color="#990000">**</font><font color="#993399">2</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">/=</font> <font color="#993399">10</font><font color="#990000">**</font><font color="#993399">2</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">2</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;=</font> <font color="#993399">10</font><font color="#990000">**</font><font color="#993399">1</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                result <font color="#990000">+=</font> <font color="#993399">1</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
        <font color="#FF0000">}</font>
        <b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@dev</font><i><font color="#9A1900"> Return the log in base 10, following the selected rounding direction, of a positive value.</font></i>
<i><font color="#9A1900">     * Returns 0 if given 0.</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">log10</font></b><font color="#990000">(</font><font color="#008080">uint256</font> value<font color="#990000">,</font> <font color="#008080">Rounding</font> rounding<font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint256<font color="#990000">)</font> <font color="#FF0000">{</font>
        unchecked <font color="#FF0000">{</font>
            <font color="#008080">uint256</font> result <font color="#990000">=</font> <b><font color="#000000">log10</font></b><font color="#990000">(</font>value<font color="#990000">);</font>
            <b><font color="#0000FF">return</font></b> result <font color="#990000">+</font> <font color="#990000">(</font>rounding <font color="#990000">==</font> Rounding<font color="#990000">.</font>Up <font color="#990000">&amp;&amp;</font> <font color="#993399">10</font><font color="#990000">**</font>result <font color="#990000">&lt;</font> value <font color="#990000">?</font> <font color="#993399">1</font> <font color="#990000">:</font> <font color="#993399">0</font><font color="#990000">);</font>
        <font color="#FF0000">}</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@dev</font><i><font color="#9A1900"> Return the log in base 256, rounded down, of a positive value.</font></i>
<i><font color="#9A1900">     * Returns 0 if given 0.</font></i>
<i><font color="#9A1900">     *</font></i>
<i><font color="#9A1900">     * Adding one to the result gives the number of pairs of hex symbols needed to represent `value` as a hex string.</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">log256</font></b><font color="#990000">(</font><font color="#008080">uint256</font> value<font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint256<font color="#990000">)</font> <font color="#FF0000">{</font>
        <font color="#008080">uint256</font> result <font color="#990000">=</font> <font color="#993399">0</font><font color="#990000">;</font>
        unchecked <font color="#FF0000">{</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;&gt;</font> <font color="#993399">128</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">&gt;&gt;=</font> <font color="#993399">128</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">16</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;&gt;</font> <font color="#993399">64</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">&gt;&gt;=</font> <font color="#993399">64</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">8</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;&gt;</font> <font color="#993399">32</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">&gt;&gt;=</font> <font color="#993399">32</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">4</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;&gt;</font> <font color="#993399">16</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                value <font color="#990000">&gt;&gt;=</font> <font color="#993399">16</font><font color="#990000">;</font>
                result <font color="#990000">+=</font> <font color="#993399">2</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
            <b><font color="#0000FF">if</font></b> <font color="#990000">(</font>value <font color="#990000">&gt;&gt;</font> <font color="#993399">8</font> <font color="#990000">&gt;</font> <font color="#993399">0</font><font color="#990000">)</font> <font color="#FF0000">{</font>
                result <font color="#990000">+=</font> <font color="#993399">1</font><font color="#990000">;</font>
            <font color="#FF0000">}</font>
        <font color="#FF0000">}</font>
        <b><font color="#0000FF">return</font></b> result<font color="#990000">;</font>
    <font color="#FF0000">}</font>

    <i><font color="#9A1900">/**</font></i>
<i><font color="#9A1900">     * </font></i><font color="#009900">@dev</font><i><font color="#9A1900"> Return the log in base 10, following the selected rounding direction, of a positive value.</font></i>
<i><font color="#9A1900">     * Returns 0 if given 0.</font></i>
<i><font color="#9A1900">     */</font></i>
    <font color="#008080">function</font> <b><font color="#000000">log256</font></b><font color="#990000">(</font><font color="#008080">uint256</font> value<font color="#990000">,</font> <font color="#008080">Rounding</font> rounding<font color="#990000">)</font> internal <font color="#008080">pure</font> <b><font color="#000000">returns</font></b> <font color="#990000">(</font>uint256<font color="#990000">)</font> <font color="#FF0000">{</font>
        unchecked <font color="#FF0000">{</font>
            <font color="#008080">uint256</font> result <font color="#990000">=</font> <b><font color="#000000">log256</font></b><font color="#990000">(</font>value<font color="#990000">);</font>
            <b><font color="#0000FF">return</font></b> result <font color="#990000">+</font> <font color="#990000">(</font>rounding <font color="#990000">==</font> Rounding<font color="#990000">.</font>Up <font color="#990000">&amp;&amp;</font> <font color="#993399">1</font> <font color="#990000">&lt;&lt;</font> <font color="#990000">(</font>result <font color="#990000">&lt;&lt;</font> <font color="#993399">3</font><font color="#990000">)</font> <font color="#990000">&lt;</font> value <font color="#990000">?</font> <font color="#993399">1</font> <font color="#990000">:</font> <font color="#993399">0</font><font color="#990000">);</font>
        <font color="#FF0000">}</font>
    <font color="#FF0000">}</font>
<font color="#FF0000">}</font>
</tt></pre>
</body>
</html>
