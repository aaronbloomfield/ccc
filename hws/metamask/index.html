<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml' lang='' xml:lang=''>
<head>
  <meta charset='utf-8'></meta>
  <meta name='generator' content='pandoc'></meta>
  <meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=yes'></meta>
  <title>Metamask Assignment</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
  </style>
  <link rel='stylesheet' href='../../markdown.css'></link>
  <script>
  function openTab(evt, tabName) {
    // Declare all variables
    var i, tabcontent, tablinks;

    // Get all elements with class="tabcontent" and hide them
    tabcontent = document.getElementsByClassName("tabcontent");
    for (i = 0; i < tabcontent.length; i++) {
      tabcontent[i].style.display = "none";
    }

    // Get all elements with class="tablinks" and remove the class "active"
    tablinks = document.getElementsByClassName("tablinks");
    for (i = 0; i < tablinks.length; i++) {
      tablinks[i].className = tablinks[i].className.replace(" active", "");
    }

    // Show the current tab, and add an "active" class to the button that opened the tab
    document.getElementById(tabName).style.display = "block";
    evt.currentTarget.className += " active";
  }
  </script>
  
</head>
<body>
<h1 id='metamask-assignment'>Metamask Assignment</h1>
<p><a href='../index.html'>Go up to the CCC HW page</a> (<a href='../index.md'>md</a>) | <a href='index-full.html'>view one-page version</a></p><div class='tab'>
<button class='tablinks' onclick="openTab(event,'toverview')" id='defaultOpen'>Overview</button>
<button class='tablinks' onclick="openTab(event,'tchangelog')">Changelog</button>
<button class='tablinks' onclick="openTab(event,'tbackground')">Background</button>
<button class='tablinks' onclick="openTab(event,'tmetamask-setup')">Metamask Setup</button>
<button class='tablinks' onclick="openTab(event,'thtml-and-javascript')">HTML And Javascript</button>
<button class='tablinks' onclick="openTab(event,'tthe-task')">The Task</button>
<button class='tablinks' onclick="openTab(event,'tweb-page-setup')">Web Page Setup</button>
<button class='tablinks' onclick="openTab(event,'ttroubleshooting')">Troubleshooting</button>
<button class='tablinks' onclick="openTab(event,'tgrading')">Grading</button>
<button class='tablinks' onclick="openTab(event,'tsubmission')">Submission</button>
</div>
<div id='toverview' class='tabcontent'><h3 id='overview'>Overview</h3>
<p>You are going to create a web interface for the Auctioneer contract you created in the <a href='../auction/index.html'>dApp Auction</a> (<a href='../auction/index.md'>md</a>) assignment. This web interface will allow for the creation of NFTs and the ability to start and stop auctions, as well as bidding on running auctions. The web page you create will reside on the departmental servers, just like with the <a href='../daoweb3/index.html'>DAO & web3</a> (<a href='../daoweb3/index.md'>md</a>) assignment.</p>
</div><div id='tchangelog' class='tabcontent'><h3 id='changelog'>Changelog</h3>
<p>Any changes to this page will be put here for easy reference. Typo fixes and minor clarifications are not listed here. So far there aren’t any significant changes to report.</p>
</div><div id='tbackground' class='tabcontent'><h3 id='background'>Background</h3>
<p>Writing this homework will require completion of the following assignments:</p>
<ul>
<li><a href='../ethprivate/index.html'>Private Ethereum Blockchain</a> (<a href='../ethprivate/index'>md</a>)</li>
<li><a href='../daoweb3/index.html'>DAO & web3</a> (<a href='../daoweb3/index.md'>md</a>) (this is for the experience with web3; the artifacts of that assignment are not needed for the current one)</li>
<li><a href='../tokens/index.html'>Ethereum Tokens</a> (<a href='../tokens/index.md'>md</a>)</li>
<li><a href='../arbitrage/index.html'>Arbitrage trading</a> (<a href='../arbitrage/index.md'>md</a>) (this is for the experience with web3; the artifacts of that assignment are not needed for the current one)</li>
<li><a href='../auction/index.html'>dApp Auction</a> (<a href='../auction/index.md'>md</a>)</li>
</ul>
<h4 id='auctioneer'>Auctioneer</h4>
<p>We are going to use your Auctioneer contract, from the <a href='../auction/index.html'>dApp Auction</a> (<a href='../auction/index.md'>md</a>) assignment. You will also need your NFTmanager contract, from the <a href='../tokens/index.html'>Ethereum Tokens</a> (<a href='../tokens/index.md'>md</a>) assignment, as well. If you did not get yours working, then contact the course staff, and we can deploy them for you to use. Otherwise, deploy your Auctioneer contract to the blockchain, and save the contract address, as it will be needed below.</p>
</div><div id='tmetamask-setup' class='tabcontent'><h3 id='metamask-setup'>MetaMask Setup</h3>
<p><img src='metamask-pop-up.webp' style='float:right;border:1px solid black;margin-left:15px'></p>
<p>This assignment uses the <a href='https://metamask.io/'>MetaMask</a> extension to Google Chrome. Unfortunately, it does not run in any other browser; meaning you can’t use Firefox, Safari, Edge, or Internet Explorer. You have to use Chrome for this assignment.</p>
<p>Here are the MetaMask setup steps:</p>
<ol type='1'>
<li>If you haven’t already, install <a href='https://www.google.com/chrome'>Google Chrome</a></li>
<li>Install the <a href='https://metamask.io/'>MetaMask</a> extension; you will see a pop-up like the image to the right
<ul>
<li>Note that on some systems it is presented as a web page rather than a pop-up, but the content of the web page is the same as the pop-up shown to the right</li>
<li>When MetaMask first installs, it will ask you if you already have a secret recovery phrase or to create a wallet – you want to create a wallet</li>
<li>It will ask you to enter a password – remember it, as you will need it each time you start up MetaMask</li>
<li>Click the network drop-down box – in the image to the right it says “localhost:8545”, but in your version it will likely say “Ethereum Mainnet”.
<ul>
<li>In that drop-down list, select “show/hide test networks”</li>
<li>That will bring you to the spot in the settings where you have to flip a toggle to “show test networks”</li>
</ul></li>
<li>In settings, click on Networks in the left-hand pane, then click on the “localhost:8545” network
<ul>
<li>Change the chain ID to the (base-10) value for our blockchain; that value can be found on the Collab landing page</li>
<li>Change the explorer URL to the URL of the course explorer (on the Collab landing page)</li>
<li>Then click save</li>
</ul></li>
<li>Back in the network selection box, you should now be able to select “localhost:8545” as your network – this is going to connect to the get node that we will be starting in a moment</li>
</ul></li>
<li>Obtain your decrypted private key for the account that you want to use. This was done in Part 4 of the <a href='../ethprivate/index.html#part-4-extract-private-key'>Private Ethereum Blockchain</a> (<a href='../ethprivate/index'>md</a>) assignment, and you also used that in the <a href='../arbitrage/index.html'>Arbitrage trading</a> (<a href='../arbitrage/index.md'>md</a>) assignment. It will be a hex value of the form <code>0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef</code></li>
<li>Start your geth node. Among any other flags that you are using, you need to supply the <code>--http</code> flag when you start geth
<ul>
<li>This causes geth to start listening to port 8545 on your computer (aka localhost), which is how MetaMask will connect</li>
<li>Does it not connect? Make sure you are running your geth node with the <code>--http</code> flag.</li>
</ul></li>
<li>Configure your account in MetaMask. To do so, click on the MetaMask icon (<img src='metamask-fox.svg' style='max-height:20px;vertical-align:middle'>) next to the address box. You will see something similar to the image to the right. Sometimes there is a noticeable delay when clicking that icon before the pop-up windows appears.
<ul>
<li>Click on the circular icon in the upper-right of the MetaMask window – in the image to the right it looks like: <img src='metamask-account-icon.webp' style='max-height:20px;vertical-align:middle'>, but will likely look different in yours</li>
<li>Click on “import account” (NOT create account!)</li>
<li>Paste in your decrypted private key and click on ‘import’</li>
<li>You should now see your balance in the account pop-up window</li>
<li>You will likely want to rename the account – MetaMask just calls them “account 1”, “account 2”, etc., and makes it hard to delete “account 1”. To rename your account, in the MetaMask window in the image to the right, click on the vertical ellipsis (⋮) to the right of the account name, then click on “account details”, then click on the pencil/edit icon to the right of the account name.</li>
</ul></li>
</ol>
<p>At this point, the MetaMask extension should be connected to your account on the private Ethereum blockchain – you can tell if this is the case because it will report your balance in the MetaMask window. Note that if you restart Chrome, you may have to enter your MetaMask password. Also, it will say “Not connected” to the left of the account name – that’s fine for now, since we have not yet created a web page for it to connect to. <br clear='all'></p>

</div><div id='thtml-and-javascript' class='tabcontent'><h3 id='html-and-javascript'>HTML and Javascript</h3>
<p>The intent is for you to start with the web site that was provided to you in the <a href='../auction/index.html'>dApp Auction</a> (<a href='../auction/index.md'>md</a>) assignment, and add some features. The URL of that web site is on the Collab landing page – you can just save that as a new HTML file, which you will want to name <code>auctions.html</code>. Note: you have to view that page with an address else most of the relevant code will not be shown. The link to that page with an address is also on the Collab landing page. You are going to create a few web forms, each of which will call a different Javascript function. Those forms – and paired functions – will perform the various actions that we need to perform on the Auctioneer: minting new NFTs, starting a new auction, closing an auction, and bidding on an auction.</p>
<h5 id='ensure-metamask-is-installed-and-enabled'>Ensure MetaMask is installed and enabled</h5>
<p>We want to ensure that any viewer of this web page has MetaMask properly installed. The following code will do that:</p>
<pre><code>&lt;script&gt;
  if ( window.ethereum === undefined )
    window.alert("Please install MetaMask; this page will not work properly without that extension installed");
&lt;/script&gt;</code></pre>
<p>This is useful as it will give a warning to those using other browsers, or those on Chrome without the MetaMask extension installed, that the site won’t work properly. In a fully developed web site, we would display the rest of the page differently if it is run without MetaMask. For this assignment, you should just display that warning. It’s fine for this assignment if the rest of your page does not display correctly without MetaMask installed. You can put this code right after the <code>&lt;body&gt;</code> opening tag.</p>
<h5 id='connecting-to-metamask'>Connecting to MetaMask</h5>
<p>The first thing a user has to do is enable the MetaMask extension to use the site; this is usually phrased as “connecting to MetaMask”. To do this, we add the following code to our HTML file (adapted from <a href='https://docs.metamask.io/guide/getting-started.html#connecting-to-metamask'>here</a>).</p>
<pre><code>&lt;button class="enableEthereumButton"&gt;Enable Ethereum&lt;/button&gt;
&lt;script&gt;
  const ethereumButton = document.querySelector('.enableEthereumButton');
  ethereumButton.addEventListener('click', () =&gt; {
    // will start the metamask extension
    ethereum.request({ method: 'eth_requestAccounts' });
  });
&lt;/script&gt;</code></pre>
<p>This connection will persist through a page reload, and – on some operating systems at least – will persist thorough a browser restart.</p>
<p>The expectation is that any user will click on that button to connect to MetaMask. You do not need to handle the case when a user tries to use the rest of the page without first connecting via this button.</p>
<h5 id='web3.js-library'>Web3.js library</h5>
<p>We could interact with MetaMask directly, but using web3.js, which we are familiar with, is going to make life much easier – it will do all the encoding of parameters into calls, etc.</p>
<p>Previously, we defined the <code>web3</code> variable as such (<code>URL</code> is on the Collab landing page):</p>
<pre><code>let web3 = new Web3('URL');</code></pre>
<p>We are now going to <em>add</em> a line:</p>
<pre><code>let web3 = new Web3('URL');
let web3mm = new Web3(window.ethereum);</code></pre>
<p>You will notice that we are creating <em>TWO</em> connections to the blockchain. The first connection is through the normal URL as was done in the <a href='../daoweb3/index.html'>DAO & web3</a> (<a href='../daoweb3/index.md'>md</a>) assignment and as is done in the auctions.php page that you are basing your code off of; that URL is on the Collab landing page. This first connection is <em>read-only</em>. The second connection is through MetaMask, which injects the <code>window.ethereum</code> object, and Web3.js can just connect via that. We will be able to send transactions through the second connection.</p>
<p>The reason we are doing two connections is because the first one supports subscriptions, which is what allows the table to be updated upon an event emission – you did that in the <a href='../daoweb3/index.html'>DAO & web3</a> (<a href='../daoweb3/index.md'>md</a>) assignment, and the auctions.php does that as well. However, that first connection does not allow sending transactions to the blockchain. The second connection, which is through MetaMask, does not support subscriptions (so no automatic updating of the tables), but does allow sending transactions to the blockchain.</p>
<p>As both are wrapped in the Web3 constructor, they operate the same way.</p>
<p>As a general rule, any one Javascript function should use only one of those connections, as they may be slightly out of sync with each other (the MetaMask one has about a 5 second delay, for example). If you are sending transactions to the blockchain, you have to use the <code>web3mm</code> one. Otherwise, use the <code>web3</code> one. As you will only have four functions that send transactions to the blockchain, only those four will use <code>web3mm</code>.</p>
<p>Likewise, we need an auction contract interface that connects through the <code>web3mm</code> connection. Currently there is this line of code in the HTML file:</p>
<pre><code>auctionContract = new web3.eth.Contract(auctioneerAbi,auctioneerContractAddress);</code></pre>
<p>We are going to <em>add</em> a line:</p>
<pre><code>auctionContractmm = new web3mm.eth.Contract(auctioneerAbi,auctioneerContractAddress);</code></pre>
<p>If a function is using the <code>web3mm</code> connection, then it should use the <code>auctionContractmm</code> contract interface.</p>
<h5 id='html-and-javascript-1'>HTML and Javascript</h5>
<p>Below is an example HTML form and associated Javascript function. This will call the <code>mintNFT()</code> function on your smart contract.</p>
<pre><code>&lt;script&gt;
  const mintNFT = async() =&gt; {
    try {
      const eth_coinbase = await web3mm.eth.getCoinbase();
      var str = document.getElementById('nftstring').value;
      await auctionContractmm.methods.mintNFT(str).send({from:eth_coinbase, gas:1000000, gasPrice:100000000000});
      const nftid = await auctionContractmm.methods.lastMintedNFT(eth_coinbase).call();
      const nfturi = await auctionContractmm.methods.tokenURI(nftid).call();
      window.alert("NFT ID: "+nftid+"\n"+nfturi);
    } catch (error) {
      console.error(error);
    }
  }
&lt;/script&gt;

&lt;form onsubmit='return false;'&gt;
  &lt;p&gt;NFT URI / string: &lt;input type='text' id='nftstring'&gt;
  &lt;input type='button' value="mint!" onClick="mintNFT();" style="width:200px"&gt;&lt;/p&gt;
&lt;/form&gt;</code></pre>
<p><img src='metamask-confirmation.webp' style='float:right;border:1px solid black;margin-left:15px'></p>
<p>There is a lot going on here, and you will need to understand it in order to be able to adapt it for the other function calls that you need to make.</p>
<ul>
<li>Notice that we are using the <code>web3mm</code> connection, since we are connecting through MetaMask.</li>
<li>We are also using the <code>auctionContractmm</code> contract, which is the one that connected through the <code>web3mm</code> connection.</li>
<li>We define the <code>mintNFT()</code> function which is an <code>async</code> function; <code>async</code> functions were described in the <a href='../daoweb3/index.html'>DAO & web3</a> (<a href='../daoweb3/index.md'>md</a>) assignment. Note that while this function has the same name as the <code>mintNFT()</code> function in the smart contract, they are still different functions.</li>
<li>One way to deal with <code>async</code> functions is to give it a code block to execute when the function returns. The other is to have it to wait until the <code>async</code> function returns. We chose the latter here by putting the <code>await</code> keyword in front of the various <code>async</code> calls in that function. Note that <code>await</code> can ONLY be called in an <code>async</code> function (and in one other situation that does not apply to us here); this is a Javascript restriction. Also note that any variable that you <code>await</code> for a value for must be a <code>const</code>.</li>
<li>To get the user’s coinbase account address, we call <code>await web3mm.eth.getCoinbase();</code> – that’s the account they are logged into via MetaMask.</li>
<li>The <code>auctionContract.methods.mintNFT(str)</code> line is where the transaction itself occurs. You will notice that this uses <code>send()</code>, not <code>sendTransaction()</code>. So this is similar to the <a href='../../docs/geth_reference.html'>geth commands we know</a> (<a href='../../docs/geth_reference.md'>md</a>), but just different enough to drive us up the wall learning a slightly different syntax for how to call the transaction.</li>
<li>For this assignment, keep the gas at 1 million and the gas price at 10 gwei (which is 10000000000 wei); yes, this is a lot of gas, but since our ETH is free, we aren’t worried about it.</li>
<li>Looking at the form, we see that the text box has an ID of <code>nftstring</code> (3rd line from the bottom). The <code>document.getElementById('nftstring').value</code> gets the value currently typed into the text box.</li>
<li>After <code>await</code>ing for the various function calls, we then display the results via an alert box: <code>window.alert("NFT ID: "+nftid+"\n"+ntfuri);</code>. A full fledged website would have a better UI for displaying this, but an alert box is sufficient for us. We assume the user will remember his/her NFT ID, and we do not have to handle the case when they forget it.</li>
<li>We put everything into a try-catch clause, as this will allow printing out of the error if one occurs. You can view that in the Javascript developer console.</li>
<li>In the form, you will notice that the form tag has the value <code>onsubmit='return false;'</code>. We want this entire web page to do all the work, and we are not submitting a form (which will reload the page). This clause prevents form submission from hitting Enter in the text box.</li>
<li>Also in the form, the button has <code>onClick="mintNFT();"</code> which will launch the <code>mintNFT()</code> Javascript function when it is clicked.</li>
<li>If you are familiar with HTML, you will notice that there is no <code>submit</code> button, as we do not want the form to be submitted (and cause a reload). If you are not familiar with HTML, and don’t know what that means, you can ignore this bullet point.</li>
</ul>
<p>When this Javascript function is called, MetaMask will pop up a window, such as what is shown to the right, to verify that you really want to send that transaction. This happens on the <code>auctionContract.methods.mintNFT(str)</code> line, since that’s the only line that is actually <em>sending</em> a transaction; the other lines are doing read-only calls. You will have to click ‘confirm’ for the transaction to be sent to the blockchain.</p>
<p>Once it is confirmed, it will take a second or so for the transaction to reach the P2P network, and then a second or two for it to be auto-mined into the blockchain. However, MetaMask can take a while (5-10 seconds) to realize that the transaction has occurred. So it can easily take 10 seconds for the pop-up window to appear. <br clear='all'></p>
</div><div id='tthe-task' class='tabcontent'><h3 id='the-task'>The Task</h3>
<p><img src='final-web-page.webp' style='float:right;border:1px solid black;margin-left:15px'></p>
<p>Finally! We can get to the whole reason for this party.</p>
<p>Your task is to create a web interface to your Auctioneer.sol contract, which fulfills the <a href='../auction/IAuctioneer.sol.html'>IAuctioneer.sol</a> (<a href='../auction/IAuctioneer.sol'>src</a>) interface. Our web page looked like the image to the right; this is the bottom of the web page, and the auction table itself was above what is shown. Yours need not look similar, but it does need to be usable.</p>
<p>As you are starting with the web site that was provided to you in the <a href='../auction/index.html'>dApp Auction</a> (<a href='../auction/index.md'>md</a>) assignment (see below for starting on that), the read-only parts of this assignment are already done for you. You will have to change the contract ID, of course – you should hard-code that into your HTML / Javascript code (just replace the address that is there – it may be there multiple times). Note: you have to view that page with an address else most of the relevant code will not be shown. The link to that page with an address is on the Collab landing page.</p>
<p>For this assignment, you only need to create an interface with four of the Auctioneer functions – <code>createAuction()</code>, <code>closeAuction()</code>, <code>placeBid()</code>, and <code>mintNFT()</code>. You will also need to have a means to transfer the NFT over, which is discussed next. Note that the interface for <code>mintNFT()</code> was provided for you, above. In particular, you do NOT have to create an interface for <code>cancelAuction()</code>. We discussed how to create a HTML form interface, and the Javascript code to make it work, above.</p>
<p>In addition to those four functions to the Auctioneer, you will also need a function that allows the transfer of an NFT over. This is the <code>safeTransferFrom()</code> function call in <a href='../auctions/IERC721.sol.html'>IERC721.sol</a> – and recall that the NFTmanager inherits from that contract. Thus, you will need to create a contract interface to that contract (similar to how <code>auctionContractmm</code> was created) – be sure to use <code>web3mm</code>! You can hard-code the address for the NFTmanager, and you can obtain that by calling <code>nftmanager()</code> on your Auctioneer contract. Note that two of the three parameters are already known – the <code>from</code> (the account that MetaMask uses, which was obtained in the <code>mintNFT()</code> function, above) and the <code>to</code> (the address of the Auctioneer contract). So only the NFT ID is what is needed.</p>
<p>For the <code>placeBid()</code> function, you will have to take in the amount that they want to bid. This should be a floating-point value of the ether to place the bid for, and your Javascript will have to convert that to wei.</p>
<p>The forms for these five functions should be on that same page – in particular, you will only be submitting one page, called <code>auctions.html</code> (note the plurality of the filename!). You can put those forms on the bottom, along with the MetaMask connect button described above. As with the <a href='../daoweb3/index.html'>DAO & web3</a> (<a href='../daoweb3/index.md'>md</a>) assignment, since this is not a course in user interfaces, it will not be graded on it’s beauty. But it still has to be usable.</p>
<p>Any calls to four of these functions (<code>createAuction()</code>, <code>closeAuction()</code>, <code>placeBid()</code> and the function to transfer the NFT) will have that change reflected in the table of auctions, which will automatically update when an event is emitted. When <code>mintNFT()</code> is called, it performs the transaction and then perform a web3.js call to get the NFT ID. It just displays that ID via a popup alert box.</p>
<p>When this assignment is complete, anybody should be able to create NFTs, initiate auctions, bid on existing auctions, and close auctions when they are done. As for the NFT images, we will still provide just a file name, and the URL prefix will be the same Collab link as in the <a href='../tokens/index.html'>Ethereum Tokens</a> (<a href='../tokens/index.md'>md</a>) assignment; that prefix is on the Collab landing page. <br clear='all'></p>
</div><div id='tweb-page-setup' class='tabcontent'><h3 id='web-page-setup'>Web page setup</h3>
<p>To get the auctions.html web page set up:</p>
<ul>
<li>Get the contract address of your deployed Auctioneer.sol contract</li>
<li>Go to the auctions.php web site (the address is on the Collab landing page), and enter that smart contract address to view those auctions
<ul>
<li>You have to view that page with an address else most of the relevant code will not be shown. The link to that page with an address is on the Collab landing page.</li>
</ul></li>
<li>Ensure that the resulting page does not display any errors (view the console in the developer tools)</li>
<li>View the source of the web page</li>
<li>Save that into auctions.html</li>
<li>Deploy auctions.html to your account on the departmental server</li>
<li>View that page – ensure it shows the same result, and also has no errors</li>
<li>Edit that file, and update the ABIs to the new versions: <a href='AuctionManager.abi'>AuctionManager.abi</a> for <code>auctioneerAbi</code> and <a href='IERC721full.abi'>IERC721.abi</a> for <code>nftManagerAbi</code></li>
<li>Add the code provided above:
<ul>
<li>The declaration of the <code>web3mm</code> variable and the <code>auctionContractmm</code> variable</li>
<li>The code to ensure MetaMask is installed</li>
<li>The code to connect to Ethereum</li>
<li>The code for the Javascript function and the form</li>
</ul></li>
<li>Redeploy and then reload the page, and mint a new NFT – it should mint it properly, and without any errors. You should be able to view that transaction on the explorer (look at the list of transactions for your account).</li>
</ul>

</div><div id='ttroubleshooting' class='tabcontent'><h3 id='troubleshooting'>Troubleshooting</h3>
<ul>
<li>“Invalid sender” error when you are submitting a transaction: while there are lots of things that could cause this, you will want to check that your chain ID is set correctly. Click on the MetaMask fox icon (<img src='metamask-fox.svg' style='max-height:20px;vertical-align:middle'>), then the circular account icon in the top right (<img src='metamask-account-icon.webp' style='max-height:20px;vertical-align:middle'>, although your may look different), then Settings, then Networks, then click on the “localhost:8545” network. Make sure the chain ID is set correctly; it’s on the Collab landing page, if you forget what it is. It should be set using it’s base-10 value.</li>
<li>MetaMask RPC error / Header not found. If you get the following error: <code>"[ethjs-query] while formatting outputs from RPC '{"value":{"code":-32603,"data":{"code":-32000,"message":"header not found"}}}'"</code>, try switching your network to Mainnet and then back to localhost:8545, as some have reported that this fixes the issue.</li>
<li>If MetaMask suddenly stops appearing to send your transactions, they may have gotten “stuck”. Each successive Ethereum transaction must have the next highest nonce. If there is a gap, then it will queue the transaction until the gap is resolved. If a block is removed from the blockchain due to being in a shorter chain, such a gap can appear. To resolve this, since everything here is free, spam some transactions (not calls) to the blockchain. Calling <code>collectFees()</code> a bunch of times from an Auctioneer contract will do the trick.</li>
</ul>
</div><div id='tgrading' class='tabcontent'><h3 id='grading'>Grading</h3>
<p>The grades on this are going to be rather binary – if it works, then full (or close to full) credit. If it doesn’t work, then very little or no credit. In particular, there will be very little partial credit awarded on this assignment. This assignment is graded by a human; it cannot be auto-graded.</p>
</div><div id='tsubmission' class='tabcontent'><h3 id='submission'>Submission</h3>
<p>You will need to fill in the various values from this assignment into the <a href='metamask.py.html'>metamask.py</a> (<a href='metamask.py'>src</a>) file. That file clearly indicates all the values that need to be filled in. That file, along with your Solidity source code, are the only files that must be submitted. The ‘sanity_checks’ dictionary is intended to be a checklist to ensure that you perform the various other aspects to ensure this assignment is fully submitted.</p>
<p>There are <em>four</em> forms of submission for this assignment; you must do all four.</p>
<p>Submission 1: You should submit your <code>auctions.html</code> file, along with your completed <code>metamask.py</code> file, to Gradescope. In particular, you are NOT submitting any Solidity code for this assignment. <strong>NOTE:</strong> Gradescope cannot fully test this assignment, as it does not have access to the private blockchain. So it can only do a few sanity tests (correct files submitted, successful compilation, valid values in metamask.py, etc.).</p>
<p>Submission 2: You must deploy your Auctioneer smart contract to our private Ethereum blockchain. It’s fine if you deploy it a few times to test it. The smart contract address for this needs to be the same as the one in your submitted <code>auctions.html</code> file.</p>
<p>Submission 3: You need to have your auctions.html properly working at https://www.cs.virginia.edu/~mst3k/auctions.html, where <code>mst3k</code> is your userid. This means it needs to be in your <code>~/public_html</code> directory on the departmental servers. You should have web.js (or web3.min.js) in that website directory. Needless to say, it should properly connect to your deployed Auctioneer smart contract.</p>
<p>Submission 4: You need to mint a few NFTs and start a few auctions. You should start three auctions using the NFT images that you created for the <a href='../auction/index.html'>dApp Auction</a> (<a href='../auction/index.md'>md</a>) assignment.</p>
</div><script>document.getElementById('defaultOpen').click();</script></body>
</html>

